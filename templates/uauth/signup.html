{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/signup/vars.css' %}">
  <link rel="stylesheet" href="{% static 'css/signup/style.css' %}">

  <style>
    * { box-sizing: border-box; margin:0; padding:0; border:none; -webkit-font-smoothing: antialiased; }
    html, body { width:100%; height:100%; display:flex; justify-content:center; align-items:center; background-color:#F8F9FE; overflow:hidden; }
    .signup-container { position:relative; width:100%; max-width:1200px; max-height:90vh; background:#eff4ff; border-radius:12px; overflow:hidden; }
    .signup-inner { position:relative; width:1920px; height:1080px; transform:scale(0.6); transform-origin:top left; }
    .signup-container::-webkit-scrollbar { display:none; }

    /* 입력창 스타일 */
    .signup-inner input {
      font-size:24px;
      font-family:"Pretendard-SemiBold", sans-serif;
      color:#56609b;
      padding:0 10px;
      border-radius:8px;
      border:1px solid #ccc;
      outline:none;
    }
    .feedback.error { color:red; font-size:12px; }
    .feedback.success { color:green; font-size:12px; }
    .signup-inner button { cursor:pointer; }

    #email, #password1, #password2 {
    position: absolute; /* 이미 inline style로 지정되어 있어도 문제 없음 */
    z-index: 10;        /* 이미지보다 위 */
    }
    button[type="submit"] {
        z-index: 10;        /* 버튼을 이미지 위로 */
        position: absolute; /* 이미 inline style로 지정되어 있으면 중복 가능 */
    } 

    .div4 {
    color: #56609b;
    text-align: left;
    font-family: "Pretendard-Medium", sans-serif;
    font-size: 24px;
    font-weight: 500;
    opacity: 0.8;
    position: absolute;
    left: 676px;
    top: 326px;
    width: 472px;
    height: 69px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    z-index: 20;
  }

  .div10 {
    color: #56609b;
    text-align: left;
    font-family: "Pretendard-Medium", sans-serif;
    font-size: 24px;
    font-weight: 500;
    opacity: 0.8;
    position: absolute;
    left: 676px;
    top: 578px;
    width: 472px;
    height: 69px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    z-index: 20;
  }

.div11 {
    color: #56609b;
    text-align: left;
    font-family: "Pretendard-Medium", sans-serif;
    font-size: 24px;
    font-weight: 500;
    opacity: 0.8;
    position: absolute;
    left: 676px;
    top: 673px;
    width: 472px;
    height: 69px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    z-index: 20;
  }
</style>
  <title>회원가입</title>
</head>
<body>
  <div class="signup-container">
    <form method="post" action="{% url 'uauth:signup' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="signup-inner">
        <img class="rectangle-5" src="{% static 'images/signup/rectangle-50.svg' %}" />
        <div class="div2">&lt;</div>
        <div class="div3">회원가입</div>
        <img class="rectangle-6" src="{% static 'images/signup/rectangle-60.svg' %}" />

        <!-- 이메일 입력 -->
        <div class="div4">이메일을 입력해 주세요.</div>
        <input type="email" name="email" id="email" style="position:absolute; left:676px; top:340px; width:472px; height:40px;"
               value="{{ form.email.value|default:'' }}">
        <sub id="email-feedback" class="feedback" style="position:absolute; left:676px; top:405px;"></sub>
        <img class="rectangle-11" src="{% static 'images/signup/rectangle-110.svg' %}" />
        <div class="div5">인증번호 전송하기</div>

        <!-- 비밀번호 -->
        <div class="div10">비밀번호를 입력해 주세요.</div>
        <img class="rectangle-9" src="{% static 'images/signup/rectangle-90.svg' %}" />
        <input type="password" name="password1" id="password1" style="position:absolute; left:660px; top:595px; width:393px; height:40px;"
               value="{{ form.password1.value|default:'' }}">
        <div class="div11">비밀번호 확인</div>
        <img class="rectangle-10" src="{% static 'images/signup/rectangle-100.svg' %}" />
        <input type="password" name="password2" id="password2" style="position:absolute; left:660px; top:690px; width:393px; height:40px;"
               value="{{ form.password2.value|default:'' }}">
        <div id="password-feedback" class="feedback" style="position:absolute; left:659px; top:754px;">
          영문 대/소문자, 숫자, 특수문자(!?~@#$%&^) 두 종류 이상 혼용되어야 함.
          <br />
          8~16자 사이, 연속된 숫자 혹은 동일 숫자의 반복은 설정 불가함.
        </div>

        <!-- 가입 버튼 -->
        <img class="rectangle-8" src="{% static 'images/signup/rectangle-80.svg' %}" />
        <button type="submit" class="btn btn-primary" style="position:absolute; left:999px; top:864px; width:174px; height:44px; font-size:26px; color:#fff; background:#56609b; border-radius:8px;">가입하기</button>

        <div class="div8">계정이 있으신가요?</div>
      </div>
    </form>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      const password1 = document.getElementById('password1');
      const password2 = document.getElementById('password2');
      const feedback = document.getElementById('password-feedback');

      function validatePassword(pw) {
          const errors = [];

          if (pw.length < 8 || pw.length > 16) {
              errors.push("8~16자 사이여야 합니다.");
          }

          const hasUpper = /[A-Z]/.test(pw);
          const hasLower = /[a-z]/.test(pw);
          const hasNumber = /[0-9]/.test(pw);
          const hasSpecial = /[!?~@#$%&^]/.test(pw);
          const types = [hasUpper, hasLower, hasNumber, hasSpecial].filter(v => v).length;
          if (types < 2) {
              errors.push("영문, 숫자, 특수문자 중 2가지 이상 혼용해야 합니다.");
          }

          if (/(012|123|234|345|456|567|678|789|890|111|222|333|444|555|666|777|888|999)/.test(pw)) {
              errors.push("연속된 숫자 혹은 동일 숫자 반복은 불가합니다.");
          }

          return errors;
      }

      function updateFeedback() {
          const pw = password1.value;
          const pw2 = password2.value;
          const errors = validatePassword(pw);

          if (errors.length > 0) {
              feedback.classList.remove('success');
              feedback.classList.add('error');
              feedback.innerHTML = errors.join('<br>');
          } else if (pw2 && pw !== pw2) {
              feedback.classList.remove('success');
              feedback.classList.add('error');
              feedback.innerHTML = "비밀번호가 일치하지 않습니다.";
          } else if (pw && pw === pw2) {
              feedback.classList.remove('error');
              feedback.classList.add('success');
              feedback.innerHTML = "사용 가능한 비밀번호입니다.";
          } else {
              feedback.innerHTML = "";
          }
      }

      password1.addEventListener('input', updateFeedback);
      password2.addEventListener('input', updateFeedback);

      const form = document.querySelector('form');
      form.addEventListener('submit', (e) => {
          const errors = validatePassword(password1.value);
          if (errors.length > 0 || password1.value !== password2.value) {
              e.preventDefault();
              alert("비밀번호 조건을 확인하세요.");
          }
      });
  });
</script>

</body>
</html>
